<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>生成系统下的一些文件 | LoongsonGuide</title>
  <meta name="author" content="Ayden Meng">
  
  <meta name="description" content="1. Initrd通常, lib/modules/下的文件夹名称和内核的版本名是一致的, 所以可以通过下列命令生成Initrd:
1.1 dracut命令1ls lib/modules/* | xargs -I N dracut --kver N --force

1.2 mkinitramfs命令">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="生成系统下的一些文件"/>
  <meta property="og:site_name" content="LoongsonGuide"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/LoongsonGuide/atom.xml" title="LoongsonGuide" type="application/atom+xml">
  
  
    <link href="/LoongsonGuide/img/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/LoongsonGuide/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/LoongsonGuide/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/LoongsonGuide/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/LoongsonGuide/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/LoongsonGuide/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/LoongsonGuide/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/LoongsonGuide/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/LoongsonGuide/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

<meta name="generator" content="Hexo 6.3.0"></head>

<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/LoongsonGuide/">LoongsonGuide</a><span class="split"></span><span class="title">生成系统下的一些文件</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2023-11-05</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  <div class="col-xs-12 col-sm-3 col-md-3 toc"> 
	<!-- toc -->
<script type="text/javascript">
		jQuery(document).ready(function() {
 		   generateWikiTOC('.note', '.toc',  2 , 2 );
		});
</script>
  </div><!-- col-md-3 -->
  
  

  
  <div class="col-xs-12 col-sm-9 col-md-9 note">
	

	  <!-- content -->
	  <h2 id="1-Initrd"><a href="#1-Initrd" class="headerlink" title="1. Initrd"></a>1. Initrd</h2><p>通常, <code>lib/modules/</code>下的文件夹名称和内核的版本名是一致的, 所以可以通过下列命令生成<code>Initrd</code>:</p>
<h3 id="1-1-dracut命令"><a href="#1-1-dracut命令" class="headerlink" title="1.1 dracut命令"></a>1.1 dracut命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls lib/modules/* | xargs -I N dracut --kver N --force</span><br></pre></td></tr></table></figure>

<h3 id="1-2-mkinitramfs命令"><a href="#1-2-mkinitramfs命令" class="headerlink" title="1.2 mkinitramfs命令"></a>1.2 mkinitramfs命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls lib/modules/* | xargs -I N mkinitramfs /lib/modules/N -o /boot/initrd.img-N </span><br></pre></td></tr></table></figure>

<h2 id="2-GRUB"><a href="#2-GRUB" class="headerlink" title="2. GRUB"></a>2. GRUB</h2><h3 id="2-1-Grub"><a href="#2-1-Grub" class="headerlink" title="2.1 Grub"></a>2.1 Grub</h3><p>通常, <code>Grub</code>安装在当前启动系统所在的磁盘上, 如下命令可以找到当前磁盘. (希望将<code>Grub</code>安装在其他盘的同学, 看明白自己想要的效果)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mxd ~]# lsblk -P | grep &quot;$(lsblk -P | grep -w &#x27;MOUNTPOINTS=&quot;/&quot;&#x27; | sed &#x27;s/.*MAJ:MIN=&quot;\([^:]*\).*/\1/g&#x27;):0&quot; | awk -F &#x27;&quot;&#x27; &#x27;&#123;print &quot;/dev/&quot; $2&#125;&#x27;</span><br><span class="line">/dev/nvme0n1</span><br></pre></td></tr></table></figure>

<p>再通过<code>grub-install</code>或者<code>grub2-install</code>命令安装进磁盘:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-install /dev/nvme0n1</span><br></pre></td></tr></table></figure>

<h3 id="2-2-grub-cfg"><a href="#2-2-grub-cfg" class="headerlink" title="2.2 grub.cfg"></a>2.2 grub.cfg</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<h3 id="2-3-grub-efi"><a href="#2-3-grub-efi" class="headerlink" title="2.3 grub.efi"></a>2.3 grub.efi</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-mkimage -c /boot/grub/grub.cfg -o /boot/efi/EFI/BOOT/BOOTLOONGARCH64.EFI -O loongarch64-efi</span><br></pre></td></tr></table></figure>

<p><code>2.1</code>节中生成<code>grub</code>可以让<code>bios</code>找到启动设备, 自动启动.</p>
<p>假如没有执行<code>2.1</code>中的内容, 用户可以在<code>UEFI</code>下通过手动执行此节命令中生成的<code>BOOTLOONGARCH64.EFI</code>加载<code>grub</code>程序.</p>
<h2 id="3-fstab"><a href="#3-fstab" class="headerlink" title="3. fstab"></a>3. fstab</h2><p>系统启动后, 启动参数中的<code>root=</code>后面的内容将被挂载为<code>根文件系统</code>, 也就是<code>Linux</code>目录中的<code>/</code>分区, 而其他的目录的挂载依赖<code>/etc/fstab</code>中的描述, 倘若重新分区, 通常需要更新<code>/etc/fstab</code>中的内容. 里面的内容具体含义详情<a target="_blank" rel="noopener" href="https://www.bing.com/">https://www.bing.com/</a></p>
<h3 id="3-1-自动更新"><a href="#3-1-自动更新" class="headerlink" title="3.1 自动更新"></a>3.1 自动更新</h3><p>自动更新的前提是<strong>对应目录已经按照预设想法挂载</strong>, 比如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@mxd ~]# lsblk</span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda      8:0    0 238.5G  0 disk</span><br><span class="line">├─sda1   8:1    0   300M  0 part /boot/efi</span><br><span class="line">├─sda2   8:2    0   300M  0 part /boot</span><br><span class="line">├─sda3   8:3    0  41.3G  0 part /</span><br><span class="line">├─sda4   8:4    0  41.3G  0 part</span><br><span class="line">├─sda5   8:5    0 146.5G  0 part /root</span><br><span class="line">│                                /opt</span><br><span class="line">│                                /home</span><br><span class="line">│                                /var</span><br><span class="line">│                                /data</span><br><span class="line">└─sda6   8:6    0   8.8G  0 part [SWAP]</span><br></pre></td></tr></table></figure>

<p>然后使用<code>github</code>上开源的<code>genfstab</code>工具生成:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@mxd ~]# git clone https://github.com/glacion/genfstab.git</span><br><span class="line">正克隆到 &#x27;genfstab&#x27;...</span><br><span class="line">remote: Enumerating objects: 14, done.</span><br><span class="line">remote: Counting objects: 100% (3/3), done.</span><br><span class="line">remote: Compressing objects: 100% (3/3), done.</span><br><span class="line">remote: Total 14 (delta 0), reused 1 (delta 0), pack-reused 11</span><br><span class="line">接收对象中: 100% (14/14), 29.18 KiB | 281.00 KiB/s, 完成.</span><br><span class="line">处理 delta 中: 100% (2/2), 完成.</span><br><span class="line">[root@mxd ~]# cd genfstab/</span><br><span class="line">[root@mxd ~ genfstab]# ./genfstab -U &gt; /etc/fstab</span><br></pre></td></tr></table></figure>

<p>同样, 假如在制作非当前启动系统的<code>fstab</code>文件, 例如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@mxd ~]# lsblk</span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda      8:0    0 238.5G  0 disk</span><br><span class="line">├─sda1   8:1    0   300M  0 part /mnt/boot/efi</span><br><span class="line">├─sda2   8:2    0   300M  0 part /mnt/boot</span><br><span class="line">├─sda3   8:3    0  82.6G  0 part /mnt</span><br><span class="line">├─sda4   8:5    0 146.5G  0 part /mnt/home</span><br><span class="line">└─sda5   8:6    0   8.8G  0 part [SWAP]</span><br></pre></td></tr></table></figure>

<p>也同样可以使用:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mxd ~ genfstab]# ./genfstab -U &gt; /mnt/etc/fstab</span><br></pre></td></tr></table></figure>

<h3 id="3-2-手动更新"><a href="#3-2-手动更新" class="headerlink" title="3.2 手动更新"></a>3.2 手动更新</h3><p>同样, 假如在制作非当前启动系统的<code>fstab</code>文件, 例如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@mxd ~]# lsblk</span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda      8:0    0 238.5G  0 disk</span><br><span class="line">├─sda1   8:1    0   300M  0 part /mnt/boot/efi</span><br><span class="line">├─sda2   8:2    0   300M  0 part /mnt/boot</span><br><span class="line">├─sda3   8:3    0  82.6G  0 part /mnt</span><br><span class="line">├─sda4   8:5    0 146.5G  0 part /mnt/home</span><br><span class="line">└─sda5   8:6    0   8.8G  0 part [SWAP]</span><br><span class="line">[root@mxd ~]# blkid</span><br><span class="line">/dev/sda2: LABEL=&quot;bootfs&quot; UUID=&quot;6a68fa6e-4fa3-4036-91a3-6f0b2e6ff1b4&quot; BLOCK_SIZE=&quot;1024&quot; TYPE=&quot;ext3&quot; PARTUUID=&quot;2215dfd8&quot;</span><br><span class="line">/dev/sda4: LABEL=&quot;datafs&quot; UUID=&quot;b4e5345f-171e-447c-8b89-52459b29a380&quot; BLOCK_SIZE=&quot;512&quot; TYPE=&quot;xfs&quot; PARTUUID=&quot;0ba0e5ea-a&quot;</span><br><span class="line">/dev/sda3: LABEL=&quot;rootfs&quot; UUID=&quot;103a31fa-631b-4ec5-8295-0817394b36d6&quot; BLOCK_SIZE=&quot;512&quot; TYPE=&quot;xfs&quot; PARTUUID=&quot;687bdb73-3&quot;</span><br><span class="line">/dev/sda1: UUID=&quot;768C-0E8F&quot; BLOCK_SIZE=&quot;512&quot; TYPE=&quot;vfat&quot; PARTUUID=&quot;bbb4bdad-36d3-4300-872c-1c00b15588c2&quot;</span><br><span class="line">/dev/sda5: UUID=&quot;e7429117-dba5-4318-8d48-ab34b7919f6d&quot; TYPE=&quot;swap&quot; PARTUUID=&quot;5bb18f47-7756-4be9-b5c0-59d1f1d36fed&quot;</span><br></pre></td></tr></table></figure>

<p>只需要将对应分区的<code>UUID</code>填写到<code>/mnt/etc/fstab</code>中去.</p>
<p>第一列是<code>UUID</code>, 或者理解是挂载的来源</p>
<p>第二列是挂载的目标位置</p>
<p>第三列是挂载的类型</p>
<p>第四列是挂载的参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@mxd ~]# cat /mnt/etc/fstab</span><br><span class="line"># /etc/fstab: static file system information.</span><br><span class="line">#</span><br><span class="line"># Use &#x27;blkid&#x27; to print the universally unique identifier for a device; this may</span><br><span class="line"># be used with UUID= as a more robust way to name devices that works even if</span><br><span class="line"># disks are added and removed. See fstab(5).</span><br><span class="line">#</span><br><span class="line"># &lt;file system&gt;             &lt;mount point&gt;  &lt;type&gt;  &lt;options&gt;  &lt;dump&gt;  &lt;pass&gt;</span><br><span class="line">UUID=768C-0E8F                            /boot/efi      vfat    defaults,noatime 0 2</span><br><span class="line">UUID=6a68fa6e-4fa3-4036-91a3-6f0b2e6ff1b4 /boot          ext3    defaults,noatime 0 2</span><br><span class="line">UUID=103a31fa-631b-4ec5-8295-0817394b36d6 /              xfs     defaults,noatime,discard 0 1</span><br><span class="line">UUID=b4e5345f-171e-447c-8b89-52459b29a380 /home          xfs     defaults,noatime,discard 0 2</span><br><span class="line">UUID=e7429117-dba5-4318-8d48-ab34b7919f6d swap           swap    defaults,noatime 0 2</span><br><span class="line">tmpfs                                     /tmp           tmpfs   defaults,noatime,mode=1777 0 0</span><br></pre></td></tr></table></figure>

<p>其中第四列挂载的参数可以参考<code>mount -v</code>的输出, 不清楚的抄一抄上述内容, 基本是可用的.</p>
<h2 id="4-生成用户"><a href="#4-生成用户" class="headerlink" title="4. 生成用户"></a>4. 生成用户</h2><p>其实是创建用户, 任何系统都需要一个可登录的用户来操作, 那么则必须配置一个用户作为登录选项.</p>
<p>开发中常用<code>root</code>帐号通常是自带的, 但是我们需要对其设定密码, 通过<code>passwd root</code>命令.</p>
<p>如果我们需要普通用户, 则需要通过<code>useradd</code>命令创建:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@mxd ~]# useradd -m -s /bin/bash username</span><br><span class="line">[root@mxd ~]# passwd username</span><br><span class="line">新的密码：</span><br><span class="line">重新输入新的密码：</span><br><span class="line">passwd：已成功更新密码</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通常, 上述内容是制作一个操作系统最基本的内容(个人理解, 非专业说明).</p>
</blockquote>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
			
		
	
		
	
		
			
			
		
	
		
			
			
			
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
	
	
		<li class="prev"><a href="/LoongsonGuide/2023/mywiki/update_system/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/LoongsonGuide/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/LoongsonGuide/2023/mywiki/systeminfo/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  &copy; 2023 <a target="_blank" rel="noopener" href="https://github.com/AydenMeng">Ayden Meng</a>
  
      with help from <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-wixo/">Wixo</a>.    
</p>
 </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/LoongsonGuide/js/jquery.imagesloaded.min.js"></script>
<script src="/LoongsonGuide/js/gallery.js"></script>
<script src="/LoongsonGuide/js/bootstrap.min.js"></script>
<script src="/LoongsonGuide/js/jquery.tableofcontents.min.js"></script>
<script src="/LoongsonGuide/js/tocgenerator.min.js"></script>
<script src="/LoongsonGuide/js/main.js"></script>
<script src="/LoongsonGuide/js/search.js"></script> 




<link rel="stylesheet" href="/LoongsonGuide/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/LoongsonGuide/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/LoongsonGuide/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>


</body>
</html>
